---
import Button from "./Button.astro";
---

<nav class="w-full bg-[#171717] h-[4rem] sticky top-0 shadow-lg p-4 z-20">
  <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
    <!-- Header móvil -->
    <div class="flex justify-between items-center w-full md:hidden">
      <div class="text-white font-bold">Logo</div>
      <button id="mobileToggle" class="text-white focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    <!-- Menú principal -->
    <ul id="menu" class="hidden md:flex flex-col md:flex-row w-full md:w-auto items-start md:items-center space-y-2 md:space-y-0 md:space-x-4 mt-4 md:mt-0 text-white">
      <li class="w-full md:w-auto hover:text-[#CEFF1A] transition-colors">
        <a href="#" class="block py-2">Logo</a>
      </li>

      <!-- Primer menú desplegable -->
      <li class="relative dropdown group w-full md:w-auto hover:text-[#CEFF1A] transition-colors">
        <button class="dropdown-button flex items-center justify-between w-full py-2 md:py-0 focus:outline-none">
          Servicios
          <svg class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
          </svg>
        </button>
        <!-- Submenú -->
        <div class="dropdown-menu hidden bg-white text-black rounded-lg shadow-lg p-4 min-w-[12rem]">
          <a href="#" class="block p-2 hover:bg-gray-100 transition-colors">
            <p class="font-medium">Desarrollo Web</p>
            <p class="text-sm">Creamos sitios web a medida</p>
          </a>
          <a href="#" class="block p-2 hover:bg-gray-100 transition-colors">
            <p class="font-medium">Marketing Digital</p>
            <p class="text-sm">Mejoramos la presencia de tu marca</p>
          </a>
        </div>
      </li>

      <!-- Segundo menú desplegable -->
      <li class="relative dropdown group w-full md:w-auto hover:text-[#CEFF1A] transition-colors">
        <button class="dropdown-button flex items-center justify-between w-full py-2 md:py-0 focus:outline-none">
          Sobre nosotros
          <svg class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
          </svg>
        </button>
        <!-- Submenú -->
        <div class="dropdown-menu hidden bg-white text-black rounded-lg shadow-lg p-4 min-w-[12rem]">
          <a href="#" class="block p-2 hover:bg-gray-100 transition-colors">
            <p class="font-medium">Nuestra historia</p>
            <p class="text-sm">Conoce cómo empezamos</p>
          </a>
          <a href="#" class="block p-2 hover:bg-gray-100 transition-colors">
            <p class="font-medium">Equipo</p>
            <p class="text-sm">Conoce a nuestros expertos</p>
          </a>
        </div>
      </li>

      <li class="w-full md:w-auto hover:text-[#CEFF1A] transition-colors">
        <a href="#" class="block py-2">Clientes</a>
      </li>
    </ul>

    <!-- Botones de acción (se muestran en desktop) -->
    <div class="hidden md:flex gap-5 items-center">
      <div class="border-2 border-white rounded-full px-6 py-2 hover:border-[#CEFF1A] transition-colors">
        Compare Versions
      </div>
      <div class="rounded-full px-6 py-2 bg-white text-black flex items-center gap-2 hover:bg-[#CEFF1A] hover:border-[#CEFF1A] transition-colors">
        Contact Sales
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="icon" viewBox="0 0 24 24">
          <path d="M12 2l.324 .005a10 10 0 1 1 -.648 0l.324 -.005zm.613 5.21a1 1 0 0 0 -1.32 1.497l2.291 2.293h-5.584l-.117 .007a1 1 0 0 0 .117 1.993h5.584l-2.291 2.293l-.083 .094a1 1 0 0 0 1.497 1.32l4 -4l.073 -.082l.064 -.089l.062 -.113l.044 -.11l.03 -.112l.017 -.126l.003 -.075l-.007 -.118l-.029 -.148l-.035 -.105l-.054 -.113l-.071 -.111a1.008 1.008 0 0 0 -.097 -.112l-4 -4z"/>
        </svg>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Oculta los dropdowns por defecto */
  .dropdown-menu {
    display: none;
  }
  /* Clase para mostrarlos */
  .dropdown-menu.active {
    display: block;
  }
  /* Estilos para el menú móvil */
  @media (max-width: 767px) {
    #menu {
      display: none;
      flex-direction: column;
      background-color: #171717;
      width: 100%;
      padding: 1rem;
      position: absolute;
      top: 4rem;
      left: 0;
      z-index: 50;
    }
    #menu.active {
      display: flex;
    }
    .dropdown-menu {
      position: static;
      box-shadow: none;
      padding: 0;
    }
  }
</style>

<script type="module">
  import { computePosition, offset, flip, shift, autoUpdate } from '@floating-ui/dom';

  document.addEventListener('DOMContentLoaded', () => {
    // Toggle del menú móvil
    const mobileToggle = document.getElementById('mobileToggle');
    const menu = document.getElementById('menu');
    mobileToggle.addEventListener('click', () => {
      menu.classList.toggle('active');
    });

    // Selecciona cada dropdown
    const dropdowns = document.querySelectorAll('.dropdown');
    dropdowns.forEach((dropdown) => {
      const button = dropdown.querySelector('.dropdown-button');
      const submenu = dropdown.querySelector('.dropdown-menu');

      // Para desktop: muestra el submenú al hacer hover
      button.addEventListener('mouseenter', () => {
        if (window.innerWidth >= 768) {
          submenu.classList.add('active');
          autoUpdate(button, submenu, () => {
            computePosition(button, submenu, {
              placement: 'bottom-start',
              middleware: [offset(4), flip(), shift()]
            }).then(({ x, y }) => {
              Object.assign(submenu.style, {
                left: `${x}px`,
                top: `${y}px`,
                position: 'absolute'
              });
            });
          });
        }
      });
      button.addEventListener('mouseleave', () => {
        if (window.innerWidth >= 768) {
          submenu.classList.remove('active');
        }
      });
      
      // Para móviles: alterna el submenú al hacer click
      button.addEventListener('click', (e) => {
        if (window.innerWidth < 768) {
          e.preventDefault();
          submenu.classList.toggle('active');
        }
      });
    });
  });
</script>
